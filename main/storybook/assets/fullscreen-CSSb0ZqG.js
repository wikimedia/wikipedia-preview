var me=Object.defineProperty,ge=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var J=(e,t,i)=>t in e?me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,M=(e,t)=>{for(var i in t||(t={}))fe.call(t,i)&&J(e,i,t[i]);if(Z)for(var i of Z(t))ye.call(t,i)&&J(e,i,t[i]);return e},P=(e,t)=>ge(e,pe(t));import{f as _,l as N,m as v,s as he,h as te,d as ve,j as Q,k as K,n as $e,e as be,o as xe}from"./utils-CXB01KDw.js";const Se=(e,t,i=!0)=>{const n=new XMLHttpRequest;n.open("GET",e),n.send(),n.addEventListener("load",()=>{const s=i?JSON.parse(n.responseText):n.responseText;t(s)}),n.addEventListener("error",()=>{t(!1,n.status)})},U={},w=(e,t,i,n=!0,s=Se)=>{if(U[e]!==void 0){i(U[e]);return}s(e,(r,c)=>{r?i(U[e]=t(r)):i(!1,c)},n)},qe=e=>e.split("#")[0],we=(e,t,i,n=w)=>{const r=te(e,{action:"query",prop:"extracts|pageimages",exsentences:4,explaintext:1,exsectionformat:"plain",piprop:"thumbnail",pilimit:1,titles:t})+"&"+_();n(r,c=>{const a=c.query.pages[Object.keys(c.query.pages)[0]];return a.extract?{title:t,extractHtml:"<p>"+a.extract+"</p>",imgUrl:a.thumbnail?a.thumbnail.source:null,dir:ve(e),type:"standard"}:!1},i)},Le=(e,t,i,n=w)=>{const s=`https://${e}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(t)}?${_()}`;n(s,(r,c)=>r?r.type==="standard"||r.type==="disambiguation"?{title:r.titles.canonical,extractHtml:he(r.extract_html),imgUrl:r.thumbnail?r.thumbnail.source:null,dir:r.dir,type:r.type}:r.type==="no-extract"&&r.description?{title:r.titles.canonical,extractHtml:"<p>"+r.description+"</p>",imgUrl:r.thumbnail?r.thumbnail.source:null,dir:r.dir,type:"standard"}:(N(v(e,"preview-console-error-message",t,e),r),!1):(N(v(e,"preview-console-error-message",t,e),c),!1),i)},Me=e=>{if(!e)return null;const t=["script","meta","style","figure","table","sup.mw-ref","sup.reference",".pcs-collapse-table-container",".thumb",".hatnote","[ role='navigation' ]","#pcs-edit-section-add-title-description"].join(",");for(const i of e.querySelectorAll(t))i.remove();for(const i of e.querySelectorAll("a"))i.outerHTML=i.innerHTML;for(const i of e.querySelectorAll("p"))i.innerHTML=i.innerHTML.replace(/\s\(.*?class=".*?(ext-phonos|IPA).*?".*?\)/g,"");return e.innerText.trim()===""?null:e.outerHTML},Ee=e=>{const t=e.querySelector('meta[property="mw:leadImage"]');if(!t)return null;const i=t.getAttribute("content").split("/"),n=decodeURIComponent(i[i.length-1]),s=e.querySelector('a[href*="'+n+'"]');if(!s)return null;const r=s.querySelector("span[data-src]");if(r)return r.getAttribute("data-src");const c=s.querySelector("img[src]");return c?c.getAttribute("src"):null},Te=(e,t,i,n=w)=>{const s=`https://${e}.wikipedia.org/api/rest_v1/page/mobile-html/${encodeURIComponent(t)}?${_()}`;n(s,(r,c)=>{if(!r)return N(v(e,"preview-console-error-message",t,e),c),!1;const a=new DOMParser().parseFromString(r,"text/html"),m=Ee(a);return{sections:Array.from(a.querySelectorAll("section")).map(d=>{const p=d.querySelector("h2, h3, h4, h5, h6"),$=p?p.id:t,y=p?p.tagName.toLowerCase():"h2",h=d.querySelector("figure span.mw-file-element"),H=h?h.getAttribute("data-src"):m,L=Me(d.querySelector("p"));return L?{id:$,level:y,imgUrl:H,extractHtml:L}:null}).filter(d=>d),dir:a.body.getAttribute("dir")}},i,!1)},Xe=(e,t,i,n,s)=>{Te(e,t,r=>{for(const c of r.sections)if(c.id===i){n({title:t+"#"+i,extractHtml:c.extractHtml,imgUrl:c.imgUrl,dir:r.dir,type:"standard"});return}n(!1)},s)},Ie=(e,t,i,n=w)=>{const[s,r]=t.split("#");return r?Xe(e,s,r,i,n):t.indexOf(":")===-1?Le(e,t,i,n):we(e,t,i,n)},Re=(e,t,i,n=w)=>{t=qe(t);const s=`https://${e}.wikipedia.org/api/rest_v1/page/media-list/${encodeURIComponent(t)}`;n(s,r=>(r.items||[]).reduce((m,u)=>{if(u.showInGallery&&u.type==="image"){const d=u&&u.srcset&&`https:${u.srcset[0].src}`,p={caption:u.caption&&u.caption.text.trim(),thumb:d,title:u.title};return m.concat(p)}return m},[]),i)},et=(e,t,i)=>{let n={};Ie(e,t,s=>{s===!1?n=P(M({},n),{extractHtml:!1}):n=M(M({},n),s),n.media&&i(n)}),Re(e,t,s=>{n=P(M({},n),{media:s}),n.extractHtml!==void 0&&i(n)})},Ae=(e,t,i,n=w)=>{const s={action:"query",prop:"imageinfo",iiextmetadatafilter:"LicenseShortName|ImageDescription|Artist",iiextmetadatalanguage:e,iiextmetadatamultilang:1,iiurlwidth:Q().width,iiurlheight:Q().height,iiprop:"url|extmetadata",titles:t},r=te(e,s);n(r,c=>{const m=c.query.pages[0].imageinfo;if(!m)return{};const{Artist:u,ImageDescription:d,LicenseShortName:p}=m[0].extmetadata,$=u&&K(u.value),y=d&&K(typeof d.value=="string"&&d.value||d.value[e]||d.value[Object.keys(d.value)[0]]),h=m[0].thumburl;return{author:$,description:y,license:p&&p.value,filePage:$e(m[0].descriptionshorturl),bestFitImageUrl:h}},i)},k=1,ie=2,T=()=>window.innerWidth,F=()=>window.innerHeight,l={screenX:null,originalMarginLeft:null,currentMarginLeft:null,originalTransition:null,imgOriginalTransition:null,durationStart:null,translateX:0,translateY:0,clientX:null,clientY:null,imageRect:{}},g=[];let E=-1,X=!1;const A=e=>e.target.nodeName==="IMG"?e.target:e.target.querySelector("img"),ne=e=>e?Number(e.slice(e.indexOf("scale")+6,-1)):k,He=e=>{const i=new RegExp("translate3d\\((?<x>.*?)px, (?<y>.*?)px, (?<z>.*?)px").exec(e);return i?`translate3d(${i.groups.x}px, ${i.groups.y}px, 0px)`:`translate3d(${l.translateX}px, ${l.translateY}px, 0px)`},z=(e,t)=>{const n=[`${t}-item-caption`,`${t}-item-caption-expand-cue`,`${t}-item-caption-text`,`${t}-item-attribution`,`${t}-button`].find(s=>e.target.className.indexOf(s)>-1);return e.pointerType!=="touch"||n},C=()=>X,V=e=>e.naturalHeight<=e.naturalWidth,Ye=e=>e.naturalWidth+50<T(),D=()=>g.length,Ce=(e,t=null)=>{const i={},n=()=>t.clientY>e.naturalHeight&&!V(e)?e.naturalHeight:t.clientY;return g.length===2?(i.x=(g[0].clientX+g[1].clientX)/2,i.y=(g[0].clientY+g[1].clientY)/2):(i.x=t.clientX,i.y=n()),i},re=(e,t)=>{const i=Ce(e,t);return V(e)?i.y=i.y-e.naturalHeight:Ye(e)&&(i.x=e.naturalWidth/2,i.y=e.naturalHeight/2),`${i.x}px ${i.y}px`},Oe=e=>{for(let t=0;t<g.length;t++)if(g[t].pointerId===e.pointerId){g.splice(t,1);break}},se=e=>{e&&(e.style.transition=l.imgOriginalTransition,e.style.transform=`scale(${k})`,X=!1,l.translateX=0,l.translateY=0)},ke=e=>{const t=A(e);l.clientX=null,l.clientY=null,l.translateX=0,l.translateY=0,t.style.transformOrigin=re(t,e),C()?(t.style.transform=`scale(${k})`,X=!1):(t.style.transform=`scale(${ie})`,X=!0)},Pe=e=>{const t=A(e);if(!t)return;const i=t.getBoundingClientRect();if(l.imageRect.top=i.top,l.imageRect.bottom=i.bottom,l.imageRect.left=i.left,l.imageRect.right=i.right,g.length<1){const n=window.getComputedStyle(t);l.imgOriginalTransition=n.transition}g.push(e)},Ue=e=>{const t=A(e),i=t.style.transform,n=.01,s=.4;let r=ne(i);const c=He(i);for(let a=0;a<g.length;a++)if(e.pointerId===g[a].pointerId){g[a]=e;break}if(g.length===2){const a=Math.abs(g[0].clientX-g[1].clientX),m=Math.abs(g[0].clientY-g[1].clientY),u=Math.sqrt(Math.pow(a,2)+Math.pow(m,2));E>0&&(t.style.transformOrigin=re(t),t.style.transition="unset",u>E&&(X=!0,r+n<ie&&(r+=n,t.style.transform=`${c} scale(${r})`)),u<E&&(r-n>k+s?(r-=n,t.style.transform=`${c} scale(${r})`):se(t))),E=u}},Fe=(e,t,i,n,s)=>{const r=A(e);if(!r)return;const c=r.style.transform,a=ne(c),m=T()/8,u=T()-m,d=V(r)?F()/4:F()/8,p=F()-d,$=80;r.style.transition="unset",(!l.clientX||!l.clientY)&&(l.clientX=e.clientX,l.clientY=e.clientY);const y=l.translateX+(e.clientX-l.clientX),h=l.translateY+(e.clientY-l.clientY),H=h-l.translateY>=0,L=y-l.translateX>=0,ae=()=>{const Y=l.imageRect.left<m&&L||l.imageRect.right>u&&!L,de=l.imageRect.top<d&&H||l.imageRect.bottom>p&&!H;return Y&&de},ce=()=>{l.imageRect.top=l.imageRect.top+(h-l.translateY),l.imageRect.bottom=l.imageRect.bottom+(h-l.translateY),l.imageRect.left=l.imageRect.left+(y-l.translateX),l.imageRect.right=l.imageRect.right+(y-l.translateX),l.translateX=y,l.translateY=h,l.clientX=e.clientX,l.clientY=e.clientY},ue=Math.abs(y)-Math.abs(l.translateX)>$;if(ae())ce(),r.style.transform=`translate3d(${y}px, ${h}px, 0px) scale(${a})`;else if(ue){const Y=s==="ltr"&&y<0||s==="rtl"&&y>0;!Y&&i[n-1]?t(-1):Y&&i[n+1]&&t(1)}},ze=e=>{const t=A(e);t&&(t.style.transition=l.imgOriginalTransition),Oe(e),l.clientX=null,l.clientY=null,g.length<2&&(E=-1)},De=(e,t,i)=>{const n=window.getComputedStyle(t);l.durationStart=Date.now(),l.screenX=e.clientX,l.originalMarginLeft=+n[i].slice(0,-2),l.currentMarginLeft=+n[i].slice(0,-2),l.originalTransition=n.transition,t.style.transition="unset"},Be=(e,t,i,n)=>{const r=e.clientX-l.screenX;l.currentMarginLeft=l.originalMarginLeft+r*(n==="ltr"?1:-1),t.style[i]=l.currentMarginLeft+"px",e.preventDefault()},We=(e,t,i,n,s)=>{const r=l.originalMarginLeft-l.currentMarginLeft,c=Date.now()-l.durationStart;Math.abs(r/T())>.4||c<=300&&Math.abs(r)>5?i(r>0?1:-1):t.style[n]=-T()*s+"px"};let j=[];const G=(e,t,i,n=void 0)=>{e.addEventListener(t,i,n),j.push([e,t,i,n])},Ne=()=>{j.forEach(e=>{const[t,i,n,s]=e;t.removeEventListener(i,n,s)}),j=[]};let f=0,S="",I,O,q;const R=()=>window.innerWidth,o="wp-gallery-fullscreen-slider",je=(e,t,i,n=[],s="")=>{const r=n.map(()=>`
		<div class="${o}-item">
				<div class="${o}-item-loading">
						<div class="${o}-item-loading-spinner">
								<div class="${o}-item-loading-spinner-animation">
										<div class="${o}-item-loading-spinner-animation-bounce"></div>
								</div>
						</div>
						<div class="${o}-item-loading-text">${v(e,"gallery-loading-still")}</div>
				</div>
				<div class="${o}-item-loading-error">
					<div class="${o}-item-loading-error-text">${v(e,"gallery-loading-error")}</div>
					<div class="${o}-item-loading-error-refresh">${v(e,"gallery-loading-error-refresh")}</div>
				</div>
		</div>
		`.trim()).join("");return n.some((c,a)=>c.thumb===s?(f=a,!0):!1),S=t,I=e,O=n,q=i,`
		<div class="${o}" style="${S==="ltr"?"margin-left":"margin-right"}:-${f*R()}px">
				<div class="${o}-button previous"></div>
				<div class="${o}-button next"></div>
				${r}
		</div>
		`.trim()},Ge=e=>{const t=e.author?e.author:v(I,"gallery-unknown-author"),i=e.filePage;return`
		<div class="${o}-item-attribution">
			<div class="${o}-item-attribution-info">
				<bdi class="${o}-item-attribution-info-author">${t} (${e.license})</bdi>
				<a href="${i}" class="${o}-item-attribution-info-link" target="_blank">${v(I,"gallery-attribution-learnmore")} ${xe()}</a>
			</div>
		</div>
	`.trim()},le=(e,t=!1)=>{const i=e.querySelector(`.${o}-item-caption`),n=e.querySelector(`.${o}-item-caption-expand-cue`),s=e.querySelector(".expanded");n&&s||t&&n?(n.classList.remove("expanded"),i.style.maxHeight="95px"):n&&(n.classList.add("expanded"),i.style.maxHeight="241px")},oe=(e,t=!1)=>{const i=e.querySelector("img"),n=e.querySelector(`.${o}-item-loading`),s=e.querySelector(`.${o}-item-loading-error`),r=e.querySelector(`.${o}-item-caption`);function c(){i.naturalWidth>0&&i.naturalHeight>0?r.style.visibility="visible":requestAnimationFrame(c)}if(c(),t&&(q.querySelector(`.${o}`).querySelectorAll(`.${o}-item`).forEach(u=>{const d=u.querySelector("img"),p=u.querySelector(`.${o}-item-caption`),$=u.querySelector(`.${o}-item-attribution`);d&&u.removeChild(d),p&&u.removeChild(p),$&&u.removeChild($)}),b(0,!0),n.style.visibility="visible",s.style.visibility="hidden"),i.complete)n.style.visibility="hidden",s.style.visibility="hidden",i.style.visibility="visible";else{const a=e.querySelector(`.${o}-item-loading-text`),m=setTimeout(()=>{a.style.visibility="visible"},5e3);i.addEventListener("load",()=>{n.style.visibility="hidden",s.style.visibility="hidden",a.style.visibility="hidden",clearTimeout(m)}),i.addEventListener("error",()=>{const u=e.querySelector(`.${o}-item-loading-error-refresh`);if(n.style.visibility="hidden",i.style.visibility="hidden",!be()){const d=e.querySelector(`.${o}-item-loading-error-text`);d.innerText=v(I,"gallery-loading-error-offline"),s.classList.add("offline")}s.style.visibility="visible",clearTimeout(m),u.addEventListener("click",()=>{oe(e,!0)})})}r.addEventListener("click",()=>{le(e)})},B=(e,t=!1)=>{const s=q.querySelector(`.${o}`).querySelectorAll(`.${o}-item`)[e];s&&Ae(I,O[e].title,r=>{const c=s.querySelector("img"),a=s.querySelector(`.${o}-item-attribution`);if(!c){const u=r.description?r.description:O[e].caption?O[e].caption:"",p=`<div class="${o}-item-caption">
						${(R()<400&&u.length>128?!0:R()>400&&u.length>142)?`<div class="${o}-item-caption-expand-cue"></div>`:""}
						<div class="${o}-item-caption-text"><bdi>${u}</bdi></div>
					</div>`;s.insertAdjacentHTML("beforeend",`<div class="${o}-item-img"><img src="${r.bestFitImageUrl} ${t?"?timestamp="+Date.now():""}"/>${p}</div>`),oe(s)}a||s.insertAdjacentHTML("beforeend",Ge(r))})},b=(e=1,t=!1)=>{const i=q.querySelector(`.${o}`),n=i.querySelectorAll(`.${o}-item`),s=i.querySelector(".next"),r=i.querySelector(".previous"),c=f+e,a=n[c],m=n[f].querySelector("img");a&&(le(n[f],!0),f+=e,s.style.visibility=f===n.length-1?"hidden":"visible",r.style.visibility=f===0?"hidden":"visible",se(m),B(f,t),B(f+1,t),B(f-1,t)),i.style[S==="ltr"?"marginLeft":"marginRight"]=-R()*f+"px";const u=q.querySelector(".wp-gallery-fullscreen-counter");u.textContent=f+1+"/"+n.length},W=()=>{b(-1)},_e=()=>{const e=q.querySelector(`.${o}`),t=S==="ltr"?"marginLeft":"marginRight",i=e.querySelectorAll(`.${o}-item`);e.addEventListener("pointerdown",n=>{z(n,o)||(Pe(n),D()===1&&!C()&&De(n,e,t))}),e.addEventListener("pointermove",n=>{z(n,o)||(D()>1?Ue(n):C()?Fe(n,b,i,f,S):Be(n,e,t,S))}),e.addEventListener("pointerout",n=>{z(n,o)||(e.style.transition=l.originalTransition,D()===1&&!C()&&We(n,e,b,t,f),ze(n))})},Ve=()=>{q.querySelector(".wp-gallery-fullscreen").classList.toggle("wp-gallery-fullscreen-focus-mode")},Ze=()=>{const e=q.querySelector(`.${o}`),t=e.querySelectorAll(`.${o}-item`),i=e.querySelector(".next"),n=e.querySelector(".previous");let s=!1;b(0),_e(),e.addEventListener("click",a=>{(a.target.className===`${o}-item`||a.target.tagName==="IMG")&&(s?(clearTimeout(s),s=null,ke(a)):s=setTimeout(()=>{s=null,Ve()},300))});const r=function(a){a.style.transition="unset",a.style.marginLeft=-f*R()+"px"};let c;G(window,"resize",()=>{const a=document.querySelector("."+o);r(a),clearTimeout(c),c=setTimeout(()=>{a.style.removeProperty("transition")},100)}),t.length===1?(n.style.visibility="hidden",i.style.visibility="hidden"):(i.addEventListener("click",()=>{b()}),n.addEventListener("click",()=>{W()}),G(window,"keydown",({key:a})=>{switch(a){case"ArrowRight":case"Right":S==="ltr"?b():W();break;case"ArrowLeft":case"Left":S==="ltr"?W():b();break}}))},x="wp-gallery-fullscreen",Je=(e,t)=>`
		<div class="${x}" lang="${e}" dir="${t}">
			<div class="${x}-close"></div>
			<div class="${x}-counter"></div>
			<div class="${x}-main"></div>
		</div>
	`.trim(),ee=e=>{const t=e.querySelector(`.${x}`);e.removeChild(t),Ne()},tt=(e,t,i,n,s=document.body)=>{if(s.querySelector(`.${x}`))return;s.insertAdjacentHTML("beforeend",Je(i,n)),s.querySelector(`.${x}-main`).insertAdjacentHTML("beforeend",je(i,n,s,e,t)),s.querySelector(`.${x}-close`).addEventListener("click",()=>{ee(s)}),G(window,"keydown",({key:c})=>{(c==="Escape"||c==="Esc")&&ee(s)}),Ze()};export{Te as g,et as r,tt as s};
